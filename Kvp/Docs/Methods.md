# Kvp Methods and Properties

### Creating a Kvp

Kvp objects are created using standard VBA syntax. 
```
Dim myKvp as Kvp  ' or KvpClass.Kvp
Set myKvp = New Kvp
```
Initialisation of Kvp objects through constructors or 'Literal' descriptions of the Kvp structure are not supported.

Items may be added to a Kvp object using
- an autogenerated index**
- a provided key


** The Index is actually a Key but it helps the discussion to use a different term
 
The autogenerated index defaults to a VBA Long starting at 0.  Users can set the start value of the autogenerated index to be numeric or string using the methods
-  SetFirstIndexAsLong, or
-  SetFirstIndexAsString

A numeric index will increment by 1 each time an item is added by index.  Where the index value has been set to a string characters will be incremented in the sequence 0-9,A-Z,a-z. e.g. If the current index is set to "Hello" the next index in sequence will be "Hellp".  For "Hellz" the next index in sequence will be "Helm0".

For a standard Kvp (as opposed to a wrapped Kvp) there is no restriction on the type of key and consequently an Item added by Index may be followed by an item added by Key with the key being a different Type to that used by Index.  

The Keys and Values stored in a Kvp can be viewed in the VBA Locals window through the GetKeys and GetValues properties.

Due to the way in which VBA/C# interact it should be noted that two keys are the same only if they have the same type and Same value.

e.g. C# does not coerce 42 to long 42 therefore 42 and 42& are different keys to C#.
#### KVPair

An object intimately bound up with the Kvp object is the KVPair object.  

KVPair is a simple object providing Key and Value properties.  The Value property is the default property.  A KVpair is returned when iterating over a Kvp and which, due to the nature of VBA, must be captured in a Variant loop control variable.
```
Dim myPair as Variant
For Each myPair in myKvp
    Debug.Print myPair.Key
    Debug.Print myPair.Value
    Debug.Print myPair
Next
```
### Item(myKey)
Due to a issue with how COM works under the hood it is not reasonable to provide the index Item property.  A suitable selection of the Interface (IUnknown/IDespath) does allow .Item(myKey) to be used but this requires exclusive late binding and hence prevents the use of intellisense for the Kvp object.  Consequently the .Item(myKey) syntax is repaced by GetItem and SetItem methods.  In the KvpWrapper it is possible to provide .Item(myKey) syntax as this is provided by VBA as a wrapper to the GetItem and SetItem methods.


### GetItem
Returns the Item stored at the specified Key
```
Dim myValue as String
myValue = myKvp.GetItem(42)
```
### SetItem
Assigns the Value to the Key location.  If the Key location exists then the Value at the Key location is overwritten.
```
myKvp.SetItem 42, "Don't Panic"
```

### AddByIndex

Adds the provided Item using the next available Key. 

```
myKvp.AddByIndex 42&
myKvp.AddByIndex "Hello World"
myKvp.AddByIndex New Kvp
```
The values of myKvp would be
```
myKvp.GetValuesAsString
```
giving
```
42,There World,VBALibrary.Kvp
```
### AddByIndexAsBytes

Adds the provided string as a sequence of integer values represented by the Ascii value of each character in the string

```
myKvp.AddByIndex "Hello World"
```
The Items added to myKvp is the byte sequence 72,101,108,108,111,32,87,111,114,108,100

### AddByIndexAsCharacters
Add the provided string as a sequence of strings, 1 character per string.
```
myKvp.AddByIndexAsCharacters "Hello World"
```
Gives a sequence of values as
```
Debug.Print myKvp.GetValuesAsString

H,e,l,l,o, ,W,o,r,l,d
```
### AddByIndexFromArray
Adds the items in a VBA array to the Kvp
```
Dim myArray as Variant
myArray = Array(42&, "Don't Panic", 3.142, True)
myKvp.AddByIndexFromArray Array("Hello","There","World")
myKvp.AddByIndexFromArray Split("Hello,There,World",",")
myKvp.AddByIndexFromArray myArray
```
gives the output
```
Debug.Print myKvp.GetValuesAsString
Hello,There,World,Hello,There,World,42,Don't Panic,3.142,True
```
### AddByIndexFromCollection
Add the Items of a VBA collection to the Kvp.
```
Dim myCollection as Collection
Set myCollection = New Collection
myCollection.Add "Hello"
myCollection.Add "There"
myCollection.Add "World"
mykvp.AddByIndexFromCollection myCollection
```
gives the output
```
Debug.print myKvp.GetValuesAsString
Hello,There,World
```
### AddByKey
Adds a Key,Value pair to the Kvp.
```
myKvp.AddByKey 42&, "Don't Panic"
```

Unfortunately there is a small amount of conversion confusion between VBA and C# so when a Key is specified as a numeric literal the VBA Type characters should be used else c# may not be able to match the type of the Key literal

```
myKvp.AddByKey 42,"Do Panic"      ' 42 is an int
debug.Print myKvp.GetItem(42)     ' OK
Dim myKey as Long
myKey = 42
debug.Print myKvp.GetItem(myKey)  ' Type mismatch C# cannot match the long value of 42 with the int value of 42
```
Once a value has been added by Key, subsequent values may be added by index whereupon the previous key, whether set by AddByIndex methods or AddByKey methods, will be advanceed to the key after the key occupying the 'Last' position in the Kvp.

For example
```
myKvp.AddbyKey 42, "Don't Panic'
myKvp.AddByIndex "Pan Galactic Gargle Blaster"
```
will result in the last key in the kvp having the value of 43.
```
myKvp.AddbyKey "Don't Panic",42
myKvp.AddbyIndex 43
```
will result in the last key in the kvp having a value of "Don't Panid"
### AddByKeyFromArrays
Adds the contents of two arrays to the Kvp.  The first array specifies the keys, the second array specifies the Values.
```
Dim myKeys as variant
myKeys = Array(1,2,3,5,7,11,13)

Dim myValues as variant
myValues = Split("Each kvp key is a prime number")

myKvp.AddByKeyFromArrays myKeys, MyValues
```
This method is useful in converting a Scripting.Dictionary to a Kvp
```
myKvp.AddByKeyFromArrays myScriptinDictionary.Keys, myScriptingDictionary.Items
```
### AddByKeyFromTable 
Optional arguments: 
- CopyKeys (Default = False)
- byColumn (Default = False)

Adds the content of a two dimensional table to return a Kvp of Kvp.  The table is accessed as Item(row,column). 

The Kvp returned contains a Kvp for each row of the Table. If CopyKeys is false the first item of a row is used as a key and the remainder of the row forms the row Kvp.  If CopyKeys is true then the Key is a copy of the first row item and the row Kvp will contain all items in the row.

If byColumn is true then the transfer occurs by column rather than by row.
```
myKvp.AddByKeyFromTable myTable
myKvp.AddByKeyFromTable myTable, CopyKeys:=True
myKvp.AddByKeyFromTable myTable, byColumn:=True
myKvp.AddbyKeyFromTable myTable, byColumn:=True, CopyKeys:=True
```
### Cohorts 
Returns a Kvp of six Kvp where a second Kvp is compared against the Host.
```
set myResultKvp = myKvp.Cohorts(myKvp2)
```
Individual Kvp may be retrieved from the result Kvp using the Cohort Enumeration
```
    ' The keys in A plus keys in B that are not in A
    AllAandBOnly = 1,

    ' The Keys from B in A where B has a different value to A
    AandBDifferentValues = 2,

    ' The keys that are only in A and only in B
    InAorInB = 3,

    ' The keys that are inA and  B 
    AandBSameValues = 4,

    ' The keys in A only   
    Aonly = 5,

    ' The keys in B only
    Bonly = 6
```

In the case of AandBDifferentValues the returned Kvp is itself a set of Kvp where the Key with different values gives a Kvp of the two values from MyKvp and MyKvp2 (indexed as 0 and 1).
### Count
Returns the number of Key/Value pairs in the Kvp.
```
myItemCount = myKvp.Count
```
### Clone
Returns a new Kvp that is a copy of the host Kvp.
```
Dim myCloneKvp as Kvp
Set myCloneKvp=myKvp.Clone
```
### GetKey
Returns the Key corresponding to the Value.  If the value does not exist an exception is thrown (See HoldsValue).
```
dim myKey as Long
myKey = myKvp.GetKey(myValue)
```
### GetKeys
Returns a variant containing an array of the Keys of the Kvp.
```
Dim myArray as Variant
myArray = myKvp.GetKeys
```
### GetKeysAscending
Returns a variant contining an array of the Keys of the Kvp.  The Keys are sorted in ascending oprder based on the default sort method for the Key Type in C#.
```
Dim myAscendingKeys as Variant
myAscendingKey = myKvp.GetKeysAscending
```
### GetKeysAsString
Optional argument:
- Separator (default = ",")

Returns the Keys of a Kvp as a single string with each key seperated by the string provided in the options Separator parameter.  The Separator may be any valid VBA string.
```
Dim myKeys as String
myKeys = myKvp.GetKeysAsString  ' Keys will be separated by a ','

Dim myFormattedKeys as string
myFormattedKeys = myKvp.GetKeysAsString("+++")
```
### GetKeysAsStringAscending
Optional argument:
- Separator (default = ",")

Returns the Keys of a Kvp as a single string with each key seperated by the string provided in the optional Separator parameter.  The Keys are sorted in ascending order using the default sort for the C# type before converting to a string. The Separator may be any valid VBA string.
### GetKeysAsStringDescending
Optional argument:
- Separator (default = ",")

Returns the Keys of a Kvp as a single string with each key seperated by the string provided in the optional Separator parameter.  The Keys are sorted in descending order using the reverse of the default sort for the C# type before converting to a string. The Separator may be any valid VBA string.
### GetKeysDescending
Returns a variant contining an array of the Keys of the Kvp.  The Keys are sorted in Descending order based on the reverse of the default sort method for the Key Type in C#.
```
Dim myAscendingKeys as Variant
myAscendingKey = myKvp.GetKeysAscending
```
### GetFirst
Returns a KVPair that is a copy of the Key value pair in the 'First' location as defined by the host C# dictionary.
```
Dim myPair as KVPair
myPair = mykvp.GetFirst
Debug.Print myPair.Key
Debug.Pring myPair.Value
```
### GetLast 
Returns a KVPair that is a copy of the Key value pair in the 'Last' location as defined by the host C# dictionary.
```
Dim myPair as KVPair
myPair = mykvp.GetLast
Debug.Print myPair.Key
Debug.Pring myPair.Value
```
### GetValues
Returns a variant containing an array of the Values of the Kvp.
```
Dim myArray as Variant
myArray = myKvp.GetValues
```
### GetValuesAsString
Optional argument:
- Separator (default = ",")

Returns the Values of a Kvp as a single string with each Value seperated by the string provided in the options Separator parameter.  The Separator may be any valid VBA string.
```
Dim myValues as String
myValues = myKvp.GetValuesAsString  ' Values will be separated by a ','

Dim myFormattedValues as string
myFormattedValues = myKvp.GetValuesAsString("+++")
```
### HoldsKey
Returns True if the Key is present in the Kvp.
```
If myKvp.HoldsKey(myKey) then Exit Sub
```
### HoldsValue
Returns True if the Value is present in the KvP.
```
If myKvp.HoldsValue(ThisValue) then Exit Sub
```
### IsEmpty
Returns True if the Kvp is not initialised or contains 0 Key/Value pairs.
```
If myKvp.IsEmpty then Exit SUb
```
### IsNotEmpty
Returns True if the Kvp is NOT empty. i.e. syntactic sugar for 'NOT myKvp.IsEmpty'.
```
If myKvp.IsNotEmpty then Exit SUb
```
### KeyAt
Returns the key at the specified index fin the array of Keys generated by the GetKeys method.
```
If myKey = myKvp.KeyAt(42) Then Exit Sub
```
### LacksKey
Returns True if the specified Key is not present in the Kvp.  Syntactic sugar for 'Not myKvp.HoldsKey'.
```
If myKvp.LacksKey(myKey) Then Exit Sub
```
### LacksValue
Returns True if the specified Value is not present in the Kvp.  Syntactic sugar for 'Not myKvp.HoldsKey'.
```
If myKvp.LacksValue(ThisValue) Then Exit Sub
```
### Mirror
Returns a Kvp of Two Kvp.  Kvp at Index 0 is a Kvp of Unique values Vs Key.  The Kvp at Index 1 is a Kvp of original Keys vs the second a subsequent Non unique values.
```
Dim myUniqueValues as Kvp
Dim myCopies as Kvp
Dim myResult as Kvp
set myResult = myKvp.Mirror
Set myUniqueValues = myResult.GetItem(0)
Set myCopies = myResult.GetItem(1)
```
### Pull
Returns a copy of the Key/Value pair at the specified Key.  Deletes the Key/Value pair from the Kvp.
```
Dim myPair as KVPair
set myPair = myKvp.Pull(myKey)
```
### PullFirst
Returns a copy of the first Key/Value pair. The first position is that defined by the First method of the Host C# dictionary.
```
Dim myPair as KVPair
set myPair = myKvp.PullFirst
```
### PullLast
Returns a copy of the last Key/Value pair. The last position is that defined by the Last method of the Host C# dictionary.
```
Dim myPair as KVPair
set myPair = myKvp.PullFirst
```
### Remove
Removes the KeyValue pair at the specified key.
```
myKvp.Remove(myKey)
```
### RemoveFirst
Removes the first Key/Value pair in the Kvp. . The first position is that defined by the First method of the Host C# dictionary.
```
myKvp.RemoveFirst
```
### RemoveLast
Removes the last Key/Value pair in the Kvp. . The last position is that defined by the Last method of the Host C# dictionary.
```
myKvp.RemoveFirst
```
### RemoveAll
Removes all Key/Value pairs from the Kvp.
```
myKvp.RemoveAll
```
### SetFirstIndexAsLong
They key used by AddByIndex methods will default to VBA Long 0.  This method allows the start value of the AddByIndex methods Key to be set before any values are added to the Kvp.  
```
myKvp.SetFirstIndexAsLong 42&
```
### SetFirstIndexAsString
This method allows the start value of the AddByIndex methods Key to be set to a string before any values are added to the Kvp.
```
myKvp.SetFirstIndexAsString "Don't Panic"  
```
### SubSetByKeys
Takes a variant containing an array of Keys and returns a new Kvp with Key/Value pairs where keys are from the input array and values are from the host Kvp.  If a Key does not exist in the Host Kvp it is ignored.
```
Dim mySubSetKvp as Kvp
set mySubsetKvp=myKvp.SubSetByKeys(mySubSetKeysArray)
```
### ValuesAreUnique
Returns true if the values in the Kvp are unique.
```
if myKvp.ValuesAreUnique Then Exit Sub
```
### ValuesAreNotUnique
Returns True if the values in a Kvp contain duplicates.  Syntactic sugar for 'Not ValuesAreUnique'.
```
If myKvp.ValuesAreNotUnique Then Exit Sub
```
